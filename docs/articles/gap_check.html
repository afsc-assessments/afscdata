<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>gap_check • afscdata</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="gap_check">
<meta property="og:description" content="afscdata">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">afscdata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/development.html">Development</a>
    </li>
    <li>
      <a href="../articles/gap_check.html">gap_check</a>
    </li>
    <li>
      <a href="../articles/getting-started.html">Getting started</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>gap_check</h1>
            
      
      
      <div class="hidden name"><code>gap_check.Rmd</code></div>

    </div>

    
    
<p>A couple of simple functions to evaluate differences between updated
survey databases from GAP and historical databases.</p>
<p><code>Step 1 - connect to VPN</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load ----</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://afsc-assessments.github.io/afscdata" class="external-link">afscdata</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># globals ----</span></span>
<span><span class="va">year</span> <span class="op">=</span> <span class="fl">2024</span></span>
<span><span class="va">species</span> <span class="op">=</span> <span class="fl">30420</span> <span class="co"># northern rockfish</span></span>
<span><span class="va">area</span> <span class="op">=</span> <span class="st">'ai'</span></span>
<span><span class="va">type</span> <span class="op">=</span> <span class="st">'region'</span></span></code></pre></div>
<p>There is a function named <code>gap_check_bio()</code> in the
<code>afscdata</code> package. It produces a brief report of differences
in the databases. Note that some of the function inputs differ slightly
from the <code>afscdata</code> queries to be more in line with GAP
naming conventions.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'region'</span>, area <span class="op">=</span> <span class="va">area</span><span class="op">)</span></span>
<span><span class="va">outa</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'area'</span>, area <span class="op">=</span> <span class="va">area</span><span class="op">)</span></span>
<span><span class="va">outd</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'depth'</span>, area <span class="op">=</span> <span class="va">area</span><span class="op">)</span></span>
<span><span class="va">outi</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'inpfc'</span>, area <span class="op">=</span> <span class="va">area</span><span class="op">)</span></span>
<span><span class="va">outid</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'inpfc_depth'</span>, area <span class="op">=</span> <span class="va">area</span><span class="op">)</span></span></code></pre></div>
<p>The reports generated from these queries should be the same (or
really, really close) since they are summing over the same data, just
with different objectives.</p>
<p>The output is a list and the biomass and variance estimates can be
compared by calling the report. Here, we can see there are minor
differences that can likely be attributed to slight computational
differences.</p>
<pre><code>outa$report
# A tibble: 16 × 7
    year     tot          var   tot_g        var_g bio_diff var_diff
   &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1980  37593.  1146927834.     NA           NA    NA        NA   
 2  1983  56368.    75319232.     NA           NA    NA        NA   
 3  1986 140405.  2255266444.     NA           NA    NA        NA   
 4  1991 212812.  1080676741. 212813.  1080676741.   -0.338     0   
 5  1994  88463.  1930605884.  88463.  1930605884.   -0.2       0   
 6  1997  87391.   730236669.  87391.   730236669.   -0.171     0   
 7  2000 205373.  3627754487. 205373.  3627754487.    0.213     0   
 8  2002 178791.  2268494951. 178791.  2268494951.   -0.029     0   
 9  2004 189446   1753885854. 189446.  1753885854.   -0.112     0   
10  2006 219350.  2833224664. 219350.  2833224664.   -0.134     0   
11  2010 217319.  2256385707. 217318.  2256385707.    0.115     0   
12  2012 285164. 20603776739. 285165. 20603776739.   -0.303     0   
13  2014 472895. 21594362893. 472895. 21594362893.    0.049     0   
14  2016 253217.  2177621012. 253216.  2177621012.    0.139     0   
15  2018 212472.  1852635907. 212471.  1852635907.    0.212     0   
16  2022 287315.  4239548374. 287316.  4239548380.   -0.746    -6.27</code></pre>
<p>However if we change the area to the GOA, then we note a difference
between the regional and INPFC by depth estimates, particularly for
2005.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'region'</span>, area <span class="op">=</span> <span class="st">'GOA'</span> <span class="op">)</span></span>
<span><span class="va">outid</span> <span class="op">&lt;-</span> <span class="fu">gap_check_bio</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year</span>, species <span class="op">=</span> <span class="va">species</span>, type <span class="op">=</span> <span class="st">'inpfc_depth'</span>, area <span class="op">=</span> <span class="st">'GOA'</span> <span class="op">)</span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">report</span></span></code></pre></div>
<pre><code># A tibble: 18 × 7
    year     tot          var   tot_g        var_g bio_diff var_diff
   &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1984  39334.   127857605.     NA           NA    NA       NA    
 2  1987 136417.  1532588438.     NA           NA    NA       NA    
 3  1990 107076.  2068646138. 107076.  2068646159.    0.121  -21.2  
 4  1993 104992.  1358147916. 104992.  1358148033.   -0.007 -117.   
 5  1996  98965.   707334568.  98965.   707334567.    0.148    0.938
 6  1999 242187. 21641102940. 242187. 21641102895.   -0.271   44.6  
 7  2001 343614. 42219837391. 343614. 42219837394.   -0.151   -3.63 
 8  2003  66310.  1021150676.  66310.  1021150323.   -0.041  353.   
 9  2005 358999. 17538253085. 358999. 17538251713.   -0.088 1373.   
10  2007 221226.  7153639777. 221226.  7153639738.   -0.057   39.0  
11  2009  89896.   834489465.  89896.   834489567.    0.058 -102.   
12  2011 173642.  4504728201. 173642.  4504728555.   -0.154 -354.   
13  2013 370454. 48669985128. 370454. 48669985125.    0.055    3.37 
14  2015  48933.   278528587.  48933.   278528608.   -0.049  -20.9  
15  2017 150326.  4609076209. 150326.  4609075707.    0.016  502.   
16  2019  86725    942842957.  86725.   942842996.   -0.263  -38.8  
17  2021  90670.  1004131755.  90670.  1004131900.    0.061 -145.   
18  2023  31758.   290679663.  31758.   290679663.    0.245   -0.042</code></pre>
<pre><code>outid$report
# A tibble: 18 × 7
    year     tot          var   tot_g        var_g bio_diff var_diff
   &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1984  39334.   127857605.     NA           NA    NA       NA    
 2  1987 136417.  1532588438.     NA           NA    NA       NA    
 3  1990 107076.  2068646138. 107076.  2068646159.    0.121  -21.2  
 4  1993 104992.  1358147916. 104992.  1358148033.   -0.007 -117.   
 5  1996  98965.   707334568.  98965.   707334567.    0.148    0.938
 6  1999 242187. 21641102940. 242187. 21641102895.   -0.271   44.6  
 7  2001 343614. 42219837391. 343614. 42219837394.   -0.151   -3.63 
 8  2003  66310.  1021150676.  66310.  1021150323.   -0.041  353.   
 9  2005 358999. 17538253085. 358961. 17538250296.   37.5   2789.   
10  2007 221226.  7153639777. 221226.  7153639738.   -0.057   39.0  
11  2009  89896.   834489465.  89896.   834489567.    0.058 -102.   
12  2011 173642.  4504728201. 173642.  4504728555.   -0.154 -354.   
13  2013 370454. 48669985128. 370454. 48669985125.    0.055    3.37 
14  2015  48933.   278528587.  48933.   278528608.   -0.049  -20.9  
15  2017 150326.  4609076209. 150326.  4609075707.    0.016  502.   
16  2019  86725    942842957.  86725.   942842996.   -0.263  -38.8  
17  2021  90670.  1004131755.  90670.  1004131900.    0.061 -145.   
18  2023  31758.   290679663.  31758.   290679663.    0.245   -0.042</code></pre>
<p>We can dril down to see where this difference may be coming from (and
chat with GAP if there are questions). Note the different variable names
in the datasets.<br>
In this instance it looks like the number of hauls is being treated
differently within the two datasets.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outid</span><span class="op">$</span><span class="va">orig</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>haul <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">haul_count</span><span class="op">)</span>,</span>
<span>            count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">catch_count</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="va">outid</span><span class="op">$</span><span class="va">gap</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>haul_g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_haul</span><span class="op">)</span>,</span>
<span>              count_g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_count</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>haul_diff <span class="op">=</span> <span class="va">haul</span> <span class="op">-</span> <span class="va">haul_g</span>,</span>
<span>         count_diff <span class="op">=</span> <span class="va">count</span> <span class="op">-</span> <span class="va">count_g</span><span class="op">)</span></span></code></pre></div>
<pre><code>Joining with `by = join_by(year)`
# A tibble: 18 × 7
    year  haul count haul_g count_g haul_diff count_diff
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1  1984   929   157     NA      NA        NA         NA
 2  1987   783   202     NA      NA        NA         NA
 3  1990   708   130    708     129         0          1
 4  1993   774   148    774     148         0          0
 5  1996   807   135    807     135         0          0
 6  1999   764   119    717     119        47          0
 7  2001   489   107    489     107         0          0
 8  2003   809   126    794     126        15          0
 9  2005   837   147    802     146        35          1
10  2007   816   139    777     139        39          0
11  2009   823   132    795     132        28          0
12  2011   670    89    653      89        17          0
13  2013   548    86    536      86        12          0
14  2015   771    95    743      95        28          0
15  2017   536    92    525      92        11          0
16  2019   541    74    531      74        10          0
17  2021   529    70    519      70        10          0
18  2023   526    52    516      52        10          0</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Benjamin Williams.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
